{% extends 'layout.html' %}

{% block title %}
    TurView
{% endblock %}

{% block body %}
    <script>
        document.getElementById('recordButton').addEventListener('click', function() {
            if (this.textContent === 'Record') {
                // Start recording logic
                this.textContent = 'Stop';
            } else {
                // Stop recording logic
                this.textContent = 'Record';
            }
        });

        // Function to update the image and question dynamically
        function updateInterviewState(imageNum, questionText) {
            switch(imageNum) {
                case 1:
                    imageSrc = 'TurView/static/TurView_Bot_Listening.png';
                    break;
                case 2:
                    imageSrc = 'TurView/static/TurView_Bot_Speaking1.png';
                    break;
                case 3:
                    imageSrc = 'TurView/static/TurView_Bot_Speaking2.png';
                    break;
                default:
                    imageSrc = 'TurView/static/TurView_Bot_Greeting.png';
            }
            
            document.getElementById('dynamicImage').src = imageSrc;
            document.getElementById('currentQuestion').textContent = questionText;
        }

        // Function to fetch updates from the server using AJAX framework
        async function fetchUpdate() {
            fetch('/update_state', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                updateInterviewState(data.image_num, data.question_text);
            })
            .catch(error => console.error('Error:', error));
        }

        // Add event listener to the update button
        document.getElementById('updateButton').addEventListener('click', fetchUpdate);
    </script>
    <a href="/"><img src="../static/TurView-logo.png" alt="logo" class="float-start history_logo"></a>
    <div class="center-frame">
        <img id="dynamicImage" src="../static/TurView_Bot_Greeting.png" alt="bot" class="center-image">
        <div class="banner">
            <h6>Current Question: <span id="currentQuestion">{{ question }}</span></h6>
        </div>
    </div>
    <div>
        <button id="recordButton">Record Answer</button>
        <button id="updateButton">Update</button> <!-- New button to trigger update -->
        <div id="transcription"></div>
    </div>
{% endblock %}